name: Branch Cleanup

on:
  delete:
    branches:
      - '*'

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger CircleCI Cleanup Job
        env:
          CIRCLECI_API_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          DELETED_BRANCH_NAME=${GITHUB_REF#refs/heads/}
          echo "Branch deletion event detected. Triggering CircleCI job for branch: $DELETED_BRANCH_NAME"
          curl --location 'https://circleci.com/api/v2/project/gh/yevheniydomin/githubwebhooks_test/pipeline' \
          --header 'Circle-Token: CCIPAT_88STvS9VTBEXwXYvxS8tcj_a27ae6c68ea1222fc8aa2c70d0b39deb40ab7b46' \
          --header 'Content-Type: text/plain' \
          -d "parameters [BRANCH_NAME=$DELETED_BRANCH_NAME]"


