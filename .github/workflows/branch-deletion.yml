name: Branch Cleanup

on:
  delete:
    branches:
      - '*'

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: trigger circleci
        env:
          CIRCLECI_API_TOKEN: ${{ secrets.CIRCLECI_PRIVATE }}
          BRANCH_NAME: ${GITHUB_REF#refs/heads/}
        run: |
          BRANCH_NAME=${GITHUB_REF#refs/heads/}
          echo "Branch deletion event detected. Triggering CircleCI job for branch: $DELETED_BRANCH_NAME"
          curl -X POST 'https://circleci.com/api/v2/project/gh/yevheniydomin/githubwebhooks_test/pipeline' \
          --header "Circle-Token: $CIRCLECI_API_TOKEN" \
          --header "content-type: application/json" \
          --data '{"branch": "main", "BRANCH_NAME":"${GITHUB_REF#refs/heads/}"}'
